/*
 * initramfs init program for kernel 5.4.x.
 * beep function.
 * Copyright (C) by IGEL Technology GmbH 2019
 * @author: Stefan Gottwald

 * This program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 2 of the License, or
 * (at your option) any later version.

 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.

 * You should have received a copy of the GNU General Public License
 * along with this program; if not, write to the Free Software
 * Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
 */

/*
 * helper for converting beep codes
 *
 * echo "code" | sed "s#-l[ \t]\{1,\}\([^ \t]\{1,\}\)[ \t]\{1,\}-f[ \t]\{1,\}\([^ \t]\{1,\}\)[ \t]\{1,\}-D[ \t]\{1,\}\([^ \t]\{1,\}\)[ \t]\{1,\}[-]*-n[^ \t]*#{\1, \2, \3},\n# g; s#-f[ \t]\{1,\}\([^ \t]\{1,\}\)[ \t]\{1,\}-l[ \t]\{1,\}\([^ \t]\{1,\}\)[ \t]\{1,\}[-]*-n[^ \t]*#{\2, \1, 0},\n# g; s#-l[ \t]\{1,\}\([^ \t]\{1,\}\)[ \t]\{1,\}-f[ \t]\{1,\}\([^ \t]\{1,\}\)[ \t]\{1,\}[-]*-n[^ \t]*#{\1, \2, 0},\n# g"
 *
 */

#include <sys/types.h>
#include <sys/stat.h>
#include <sys/ioctl.h>
#include <stdio.h>
#include <stdlib.h>
#include <stdarg.h>
#include <string.h>
#include <fcntl.h>
#include <stddef.h>
#include <unistd.h>
#include <linux/kd.h>
#include <linux/vt.h>
#include "init.h"
#include <unistd.h>
#include <errno.h>

#define BELL_CLOCK 1193180

/* struct for beep codes */

struct play {
	double length;
	double freq;
	double delay;
};

/* the imperial march out of star wars */

__attribute__((unused)) static struct play imperial_march[] = {
	{350, 392, 100},
	{350, 392, 100},
	{350, 392, 100},
	{250, 311.1, 100},
	{25, 466.2, 100},
	{350, 392, 100},
	{250, 311.1, 100},
	{25, 466.2, 100},
	{700, 392, 100},
	{350, 587.32, 100},
	{350, 587.32, 100},
	{350, 587.32, 100},
	{250, 622.26, 100},
	{25, 466.2, 100},
	{350, 369.99, 100},
	{250, 311.1, 100},
	{25, 466.2, 100},
	{700, 392, 100},
	{350, 784, 100},
	{250, 392, 100},
	{25, 392, 100},
	{350, 784, 100},
	{250, 739.98, 100},
	{25, 698.46, 100},
	{25, 659.26, 100},
	{25, 622.26, 100},
	{50, 659.26, 400},
	{25, 415.3, 200},
	{350, 554.36, 100},
	{250, 523.25, 100},
	{25, 493.88, 100},
	{25, 466.16, 100},
	{25, 440, 100},
	{50, 466.16, 400},
	{25, 311.13, 200},
	{350, 369.99, 100},
	{250, 311.13, 100},
	{25, 392, 100},
	{350, 466.16, 100},
	{250, 392, 100},
	{25, 466.16, 100},
	{700, 587.32, 100},
	{350, 784, 100},
	{250, 392, 100},
	{25, 392, 100},
	{350, 784, 100},
	{250, 739.98, 100},
	{25, 698.46, 100},
	{25, 659.26, 100},
	{25, 622.26, 100},
	{50, 659.26, 400},
	{25, 415.3, 200},
	{350, 554.36, 100},
	{250, 523.25, 100},
	{25, 493.88, 100},
	{25, 466.16, 100},
	{25, 440, 100},
	{50, 466.16, 400},
	{25, 311.13, 200},
	{350, 392, 100},
	{250, 311.13, 100},
	{25, 466.16, 100},
	{300, 392.00, 150},
	{250, 311.13, 100},
	{25, 466.16, 100},
	{700, 392, 0},
	{0, 0, 0}};

/* Beverly Hill copy theme */

__attribute__((unused)) static struct play beverly_hill[] = {
	{460, 659, 0},
	{340, 784, 0},
	{230, 659, 0},
	{110, 659, 0},
	{230, 880, 0},
	{230, 659, 0},
	{230, 587, 0},
	{460, 659, 0},
	{340, 988, 0},
	{230, 659, 0},
	{110, 659, 0},
	{230, 1047, 0},
	{230, 988, 0},
	{230, 784, 0},
	{230, 659, 0},
	{230, 988, 0},
	{230, 1318, 0},
	{110, 659, 0},
	{230, 587, 0},
	{110, 587, 0},
	{230, 494, 0},
	{230, 740, 0},
	{460, 659, 0},
	{0, 0, 0}};

/* Soviet Anthem march */

__attribute__((unused)) static struct play soviet[] = {
	{375, 392, 0},
	{750, 523, 0},
	{463, 392, 0},
	{187, 440, 0},
	{750, 494, 0},
	{375, 330, 0},
	{375, 330, 0},
	{750, 440, 0},
	{463, 392, 0},
	{187, 349, 0},
	{750, 392, 0},
	{463, 262, 0},
	{187, 262, 0},
	{750, 294, 0},
	{463, 294, 0},
	{187, 330, 0},
	{750, 349, 0},
	{463, 349, 0},
	{187, 392, 0},
	{750, 440, 0},
	{375, 494, 0},
	{375, 523, 0},
	{1125,587, 0},
	{0, 0, 0}};

/* The 5th Symphony */

__attribute__((unused)) static struct play fifth_symphony[] = {
	{198.37, 392.00, 0.83},
	{198.37, 392.00, 0.83},
	{198.37, 392.00, 0.83},
	{795.97, 311.13, 200.03},
	{198.37, 349.23, 0.83},
	{198.37, 349.23, 0.83},
	{198.37, 349.23, 0.83},
	{795.97, 293.66, 200.03},
	{198.37, 392.00, 0.83},
	{198.37, 392.00, 0.83},
	{198.37, 392.00, 0.83},
	{198.37, 311.13, 0.83},
	{198.37, 415.30, 0.83},
	{198.37, 415.30, 0.83},
	{198.37, 415.30, 0.83},
	{198.37, 392.00, 0.83},
	{198.37, 622.25, 0.83},
	{198.37, 622.25, 0.83},
	{198.37, 622.25, 0.83},
	{795.97, 523.25, 200.03},
	{198.37, 392.00, 0.83},
	{198.37, 392.00, 0.83},
	{198.37, 392.00, 0.83},
	{198.37, 293.66, 0.83},
	{198.37, 415.30, 0.83},
	{198.37, 415.30, 0.83},
	{198.37, 415.30, 0.83},
	{198.37, 392.00, 0.83},
	{198.37, 698.46, 0.83},
	{198.37, 698.46, 0.83},
	{198.37, 698.46, 0.83},
	{795.97, 587.33, 200.03},
	{0, 0, 0}, // STOP HERE FOR NOW
	{198.37, 392.00, 0.83},
	{198.37, 392.00, 0.83},
	{198.37, 349.23, 0.83},
	{198.37, 311.13, 0.83},
	{198.37, 155.56, 0.83},
	{198.37, 155.56, 0.83},
	{198.37, 174.61, 0.83},
	{198.37, 196.00, 0.83},
	{198.37, 392.00, 0.83},
	{198.37, 392.00, 0.83},
	{198.37, 349.23, 0.83},
	{198.37, 311.13, 0.83},
	{198.37, 155.56, 0.83},
	{198.37, 155.56, 0.83},
	{198.37, 174.61, 0.83},
	{198.37, 196.00, 0.83},
	{198.37, 392.00, 0.83},
	{198.37, 392.00, 0.83},
	{198.37, 349.23, 0.83},
	{198.37, 311.13, 598.43},
	{48.97, 130.81, 0.83},
	{48.97, 261.63, 0.83},
	{98.77, 311.13, 0.83},
	{596.77, 369.99, 0.83},
	{48.97, 123.47, 0.83},
	{48.97, 293.66, 0.83},
	{696.37, 392.00, 200.03},
	{198.37, 392.00, 0.83},
	{198.37, 392.00, 0.83},
	{198.37, 392.00, 0.83},
	{795.97, 261.63, 0.83},
	{795.97, 293.66, 0.83},
	{795.97, 196.00, 0.83},
	{397.57, 392.00, 0.83},
	{397.57, 523.25, 0.83},
	{397.57, 493.88, 0.83},
	{397.57, 523.25, 0.83},
	{397.57, 587.33, 0.83},
	{397.57, 440.00, 0.83},
	{397.57, 440.00, 0.83},
	{198.37, 392.00, 200.03},
	{397.57, 392.00, 0.83},
	{397.57, 523.25, 0.83},
	{397.57, 493.88, 0.83},
	{397.57, 523.25, 0.83},
	{397.57, 587.33, 0.83},
	{397.57, 440.00, 0.83},
	{397.57, 440.00, 0.83},
	{198.37, 392.00, 200.03},
	{397.57, 392.00, 0.83},
	{397.57, 440.00, 0.83},
	{397.57, 466.16, 0.83},
	{397.57, 440.00, 0.83},
	{397.57, 392.00, 0.83},
	{397.57, 440.00, 0.83},
	{397.57, 392.00, 0.83},
	{198.37, 349.23, 200.03},
	{397.57, 523.25, 0.83},
	{397.57, 587.33, 0.83},
	{397.57, 622.25, 0.83},
	{397.57, 587.33, 0.83},
	{397.57, 523.25, 0.83},
	{397.57, 587.33, 0.83},
	{397.57, 523.25, 0.83},
	{198.37, 466.16, 200.03},
	{397.57, 523.25, 0.83},
	{397.57, 587.33, 0.83},
	{397.57, 622.25, 0.83},
	{397.57, 587.33, 0.83},
	{397.57, 523.25, 0.83},
	{397.57, 587.33, 0.83},
	{397.57, 622.25, 0.83},
	{397.57, 587.33, 0.83},
	{397.57, 523.25, 0.83},
	{397.57, 587.33, 0.83},
	{397.57, 622.25, 0.83},
	{397.57, 587.33, 0.83},
	{397.57, 622.25, 0.83},
	{397.57, 739.99, 0.83},
	{795.97, 783.99, 200.03},
	{198.37, 880.00, 0.83},
	{198.37, 783.99, 0.83},
	{198.37, 698.46, 0.83},
	{198.37, 698.46, 0.83},
	{198.37, 659.26, 0.83},
	{198.37, 587.33, 0.83},
	{198.37, 523.25, 0.83},
	{198.37, 523.25, 0.83},
	{198.37, 493.88, 0.83},
	{198.37, 440.00, 0.83},
	{198.37, 493.88, 0.83},
	{198.37, 587.33, 0.83},
	{198.37, 523.25, 0.83},
	{198.37, 392.00, 0.83},
	{198.37, 329.63, 0.83},
	{198.37, 493.88, 0.83},
	{198.37, 440.00, 0.83},
	{198.37, 349.23, 0.83},
	{198.37, 293.66, 0.83},
	{198.37, 440.00, 0.83},
	{198.37, 392.00, 0.83},
	{198.37, 329.63, 0.83},
	{198.37, 261.63, 0.83},
	{198.37, 196.00, 0.83},
	{198.37, 739.99, 0.83},
	{198.37, 783.99, 0.83},
	{198.37, 739.99, 0.83},
	{198.37, 783.99, 0.83},
	{198.37, 739.99, 0.83},
	{198.37, 783.99, 0.83},
	{198.37, 739.99, 0.83},
	{198.37, 783.99, 0.83},
	{198.37, 880.00, 0.83},
	{198.37, 783.99, 0.83},
	{198.37, 698.46, 0.83},
	{198.37, 698.46, 0.83},
	{198.37, 659.26, 0.83},
	{198.37, 587.33, 0.83},
	{198.37, 523.25, 0.83},
	{198.37, 523.25, 0.83},
	{198.37, 493.88, 0.83},
	{198.37, 440.00, 0.83},
	{198.37, 493.88, 0.83},
	{198.37, 587.33, 0.83},
	{198.37, 523.25, 0.83},
	{198.37, 392.00, 0.83},
	{198.37, 329.63, 0.83},
	{198.37, 493.88, 0.83},
	{198.37, 440.00, 0.83},
	{198.37, 349.23, 0.83},
	{198.37, 293.66, 0.83},
	{198.37, 440.00, 0.83},
	{198.37, 392.00, 0.83},
	{198.37, 329.63, 0.83},
	{198.37, 261.63, 0.83},
	{198.37, 196.00, 0.83},
	{198.37, 739.99, 0.83},
	{198.37, 783.99, 0.83},
	{198.37, 739.99, 0.83},
	{198.37, 783.99, 0.83},
	{198.37, 739.99, 0.83},
	{198.37, 783.99, 0.83},
	{198.37, 739.99, 0.83},
	{198.37, 783.99, 0.83},
	{198.37, 739.99, 0.83},
	{198.37, 783.99, 0.83},
	{198.37, 739.99, 0.83},
	{198.37, 783.99, 0.83},
	{198.37, 783.99, 0.83},
	{198.37, 783.99, 0.83},
	{198.37, 783.99, 0.83},
	{198.37, 783.99, 0.83},
	{198.37, 783.99, 0.83},
	{198.37, 783.99, 0.83},
	{198.37, 783.99, 0.83},
	{795.97, 622.25, 200.03},
	{198.37, 698.46, 0.83},
	{198.37, 698.46, 0.83},
	{198.37, 698.46, 0.83},
	{795.97, 587.33, 200.03},
	{198.37, 783.99, 0.83},
	{198.37, 783.99, 0.83},
	{198.37, 783.99, 0.83},
	{397.57, 622.25, 0.83},
	{397.57, 830.61, 0.83},
	{397.57, 783.99, 0.83},
	{397.57, 1244.51, 0.83},
	{795.97, 1046.50, 200.03},
	{198.37, 783.99, 0.83},
	{198.37, 783.99, 0.83},
	{198.37, 783.99, 0.83},
	{397.57, 587.33, 0.83},
	{397.57, 830.61, 0.83},
	{397.57, 783.99, 0.83},
	{397.57, 1396.91, 0.83},
	{795.97, 1174.66, 200.03},
	{198.37, 493.88, 0.83},
	{198.37, 493.88, 0.83},
	{198.37, 493.88, 0.83},
	{198.37, 523.25, 797.63},
	{198.37, 493.88, 0.83},
	{198.37, 493.88, 0.83},
	{198.37, 493.88, 0.83},
	{198.37, 523.25, 797.63},
	{198.37, 987.77, 0.83},
	{198.37, 987.77, 0.83},
	{198.37, 987.77, 0.83},
	{795.97, 1046.50, 0},
	{0, 0, 0}};

/* Die kleine Nachtmusik */

__attribute__((unused)) static struct play night_music[] = {
	{639.91, 587.33, 0.89},
	{212.71, 440.00, 0.89},
	{639.91, 587.33, 0.89},
	{212.71, 440.00, 0.89},
	{212.71, 587.33, 0.89},
	{212.71, 440.00, 0.89},
	{212.71, 587.33, 0.89},
	{212.71, 739.99, 0.89},
	{853.51, 880.00, 0.89},
	{639.91, 783.99, 0.89},
	{212.71, 659.26, 0.89},
	{639.91, 783.99, 0.89},
	{212.71, 659.26, 0.89},
	{212.71, 783.99, 0.89},
	{212.71, 659.26, 0.89},
	{212.71, 554.37, 0.89},
	{212.71, 659.26, 0.89},
	{853.51, 440.00, 0.89},
	{0, 0, 0}, // STOP HERE FOR NOW
	{426.31, 587.33, 0.89},
	{639.91, 587.33, 0.89},
	{212.71, 739.99, 0.89},
	{212.71, 659.26, 0.89},
	{212.71, 587.33, 0.89},
	{212.71, 587.33, 0.89},
	{212.71, 554.37, 0.89},
	{639.91, 554.37, 0.89},
	{212.71, 659.26, 0.89},
	{212.71, 783.99, 0.89},
	{212.71, 659.26, 0.89},
	{212.71, 659.26, 0.89},
	{212.71, 587.33, 0.89},
	{639.91, 587.33, 0.89},
	{212.71, 739.99, 0.89},
	{212.71, 659.26, 0.89},
	{212.71, 587.33, 0.89},
	{212.71, 587.33, 0.89},
	{212.71, 554.37, 0.89},
	{639.91, 554.37, 0.89},
	{212.71, 659.26, 0.89},
	{212.71, 783.99, 0.89},
	{212.71, 554.37, 0.89},
	{212.71, 587.33, 0.89},
	{212.71, 587.33, 0.89},
	{105.91, 587.33, 0.89},
	{105.91, 554.37, 0.89},
	{105.91, 493.88, 0.89},
	{105.91, 554.37, 0.89},
	{212.71, 587.33, 0.89},
	{212.71, 587.33, 0.89},
	{105.91, 739.99, 0.89},
	{105.91, 659.26, 0.89},
	{105.91, 587.33, 0.89},
	{105.91, 659.26, 0.89},
	{212.71, 739.99, 0.89},
	{212.71, 739.99, 0.89},
	{105.91, 880.00, 0.89},
	{105.91, 783.99, 0.89},
	{105.91, 739.99, 0.89},
	{105.91, 783.99, 0.89},
	{853.51, 880.00, 0.89},
	{853.51, 440.00, 0.89},
	{853.51, 493.88, 0.89},
	{212.71, 440.00, 0.89},
	{212.71, 392.00, 0.89},
	{212.71, 392.00, 0.89},
	{212.71, 392.00, 0.89},
	{212.71, 392.00, 0.89},
	{212.71, 369.99, 0.89},
	{212.71, 369.99, 0.89},
	{212.71, 369.99, 0.89},
	{212.71, 369.99, 0.89},
	{212.71, 329.63, 0.89},
	{212.71, 329.63, 0.89},
	{212.71, 329.63, 0.89},
	{212.71, 293.66, 0.89},
	{212.71, 277.18, 0.89},
	{212.71, 246.94, 0.89},
	{212.71, 277.18, 0.89},
	{426.31, 293.66, 0.89},
	{426.31, 329.63, 0.89},
	{853.51, 369.99, 0.89},
	{853.51, 440.00, 0.89},
	{853.51, 493.88, 0.89},
	{212.71, 440.00, 0.89},
	{212.71, 392.00, 0.89},
	{212.71, 392.00, 0.89},
	{212.71, 392.00, 0.89},
	{212.71, 392.00, 0.89},
	{212.71, 369.99, 0.89},
	{212.71, 369.99, 0.89},
	{212.71, 369.99, 0.89},
	{212.71, 369.99, 0.89},
	{212.71, 329.63, 0.89},
	{212.71, 329.63, 0.89},
	{212.71, 329.63, 0.89},
	{212.71, 293.66, 0.89},
	{212.71, 277.18, 0.89},
	{212.71, 246.94, 0.89},
	{212.71, 277.18, 0.89},
	{426.31, 293.66, 0.89},
	{426.31, 329.63, 0.89},
	{853.51, 369.99, 0.89},
	{1067.11, 293.66, 0.89},
	{212.71, 293.66, 0.89},
	{212.71, 329.63, 0.89},
	{212.71, 277.18, 0.89},
	{1067.11, 369.99, 0.89},
	{212.71, 369.99, 0.89},
	{212.71, 392.00, 0.89},
	{212.71, 329.63, 0.89},
	{105.91, 440.00, 0.89},
	{105.91, 440.00, 0.89},
	{105.91, 440.00, 0.89},
	{105.91, 440.00, 0.89},
	{105.91, 440.00, 0.89},
	{105.91, 440.00, 0.89},
	{105.91, 440.00, 0.89},
	{105.91, 440.00, 0.89},
	{105.91, 493.88, 0.89},
	{105.91, 493.88, 0.89},
	{105.91, 493.88, 0.89},
	{105.91, 493.88, 0.89},
	{105.91, 554.37, 0.89},
	{105.91, 554.37, 0.89},
	{105.91, 554.37, 0.89},
	{105.91, 554.37, 0.89},
	{639.91, 587.33, 0.89},
	{212.71, 440.00, 0.89},
	{319.51, 554.37, 0.89},
	{105.91, 440.00, 0.89},
	{319.51, 554.37, 0.89},
	{105.91, 440.00, 0.89},
	{639.91, 587.33, 0.89},
	{212.71, 440.00, 0.89},
	{319.51, 554.37, 0.89},
	{105.91, 440.00, 0.89},
	{319.51, 554.37, 0.89},
	{105.91, 440.00, 0.89},
	{212.71, 587.33, 0.89},
	{212.71, 440.00, 0.89},
	{212.71, 554.37, 0.89},
	{212.71, 440.00, 0.89},
	{212.71, 587.33, 0.89},
	{212.71, 440.00, 0.89},
	{212.71, 554.37, 0.89},
	{212.71, 440.00, 0.89},
	{212.71, 587.33, 0.89},
	{212.71, 293.66, 0.89},
	{212.71, 293.66, 0.89},
	{212.71, 293.66, 0.89},
	{853.51, 293.66, 0.89},
	{639.91, 440.00, 0.89},
	{105.91, 369.99, 0.89},
	{105.91, 329.63, 0.89},
	{426.31, 293.66, 0.89},
	{426.31, 493.88, 0.89},
	{426.31, 392.00, 0.89},
	{426.31, 329.63, 0.89},
	{853.51, 440.00, 0.89},
	{639.91, 739.99, 0.89},
	{105.91, 587.33, 0.89},
	{105.91, 554.37, 0.89},
	{426.31, 493.88, 0.89},
	{426.31, 783.99, 0.89},
	{853.51, 739.99, 0.89},
	{853.51, 659.26, 0.89},
	{426.31, 587.33, 0.89},
	{426.31, 440.00, 0.89},
	{212.71, 587.33, 0.89},
	{212.71, 554.37, 0.89},
	{212.71, 493.88, 0.89},
	{212.71, 440.00, 0.89},
	{212.71, 493.88, 0.89},
	{212.71, 440.00, 214.49},
	{212.71, 440.00, 0.89},
	{212.71, 440.00, 0.89},
	{212.71, 440.00, 0.89},
	{212.71, 440.00, 0.89},
	{212.71, 440.00, 0.89},
	{212.71, 493.88, 0.89},
	{212.71, 440.00, 214.49},
	{212.71, 440.00, 0.89},
	{212.71, 587.33, 0.89},
	{212.71, 554.37, 0.89},
	{212.71, 493.88, 0.89},
	{212.71, 440.00, 0.89},
	{212.71, 493.88, 0.89},
	{212.71, 440.00, 214.49},
	{212.71, 440.00, 0.89},
	{212.71, 440.00, 0.89},
	{212.71, 440.00, 0.89},
	{212.71, 440.00, 0.89},
	{212.71, 440.00, 0.89},
	{212.71, 493.88, 0.89},
	{212.71, 440.00, 428.09},
	{639.91, 493.88, 0.89},
	{105.91, 392.00, 0.89},
	{105.91, 369.99, 0.89},
	{426.31, 392.00, 428.09},
	{639.91, 440.00, 0.89},
	{105.91, 369.99, 0.89},
	{105.91, 329.63, 0.89},
	{212.71, 369.99, 0.89},
	{212.71, 369.99, 0.89},
	{212.71, 392.00, 0.89},
	{212.71, 440.00, 0.89},
	{212.71, 493.88, 0.89},
	{212.71, 587.33, 0.89},
	{212.71, 554.37, 0.89},
	{212.71, 493.88, 0.89},
	{212.71, 493.88, 0.89},
	{212.71, 440.00, 0.89},
	{212.71, 369.99, 0.89},
	{212.71, 440.00, 0.89},
	{212.71, 440.00, 0.89},
	{212.71, 392.00, 0.89},
	{212.71, 369.99, 0.89},
	{212.71, 329.63, 0.89},
	{426.31, 293.66, 0.89},
	{426.31, 440.00, 0.89},
	{212.71, 587.33, 0.89},
	{212.71, 554.37, 0.89},
	{212.71, 493.88, 0.89},
	{212.71, 440.00, 0.89},
	{212.71, 493.88, 0.89},
	{212.71, 440.00, 214.49},
	{212.71, 440.00, 0.89},
	{212.71, 440.00, 0.89},
	{212.71, 440.00, 0.89},
	{212.71, 440.00, 0.89},
	{212.71, 440.00, 0.89},
	{212.71, 493.88, 0.89},
	{212.71, 440.00, 214.49},
	{212.71, 440.00, 0.89},
	{212.71, 587.33, 0.89},
	{212.71, 554.37, 0.89},
	{212.71, 493.88, 0.89},
	{212.71, 440.00, 0.89},
	{212.71, 493.88, 0.89},
	{212.71, 440.00, 214.49},
	{212.71, 440.00, 0.89},
	{212.71, 440.00, 0.89},
	{212.71, 440.00, 0.89},
	{212.71, 440.00, 0.89},
	{212.71, 440.00, 0.89},
	{212.71, 493.88, 0.89},
	{212.71, 440.00, 428.09},
	{639.91, 987.77, 0.89},
	{105.91, 783.99, 0.89},
	{105.91, 739.99, 0.89},
	{426.31, 783.99, 428.09},
	{639.91, 880.00, 0.89},
	{105.91, 739.99, 0.89},
	{105.91, 659.26, 0.89},
	{426.31, 739.99, 428.09},
	{212.71, 493.88, 0.89},
	{212.71, 587.33, 0.89},
	{212.71, 554.37, 0.89},
	{212.71, 493.88, 0.89},
	{212.71, 440.00, 0.89},
	{212.71, 587.33, 0.89},
	{212.71, 739.99, 0.89},
	{212.71, 880.00, 0.89},
	{212.71, 880.00, 0.89},
	{212.71, 783.99, 0.89},
	{212.71, 739.99, 0.89},
	{212.71, 659.26, 0.89},
	{212.71, 587.33, 0.89},
	{212.71, 440.00, 0.89},
	{212.71, 493.88, 0.89},
	{212.71, 554.37, 0.89},
	{212.71, 587.33, 0.89},
	{212.71, 587.33, 0.89},
	{212.71, 659.26, 0.89},
	{212.71, 659.26, 0.89},
	{212.71, 739.99, 0.89},
	{212.71, 554.37, 0.89},
	{212.71, 587.33, 0.89},
	{212.71, 659.26, 0.89},
	{212.71, 739.99, 0.89},
	{212.71, 739.99, 0.89},
	{212.71, 783.99, 0.89},
	{212.71, 783.99, 0.89},
	{212.71, 880.00, 0.89},
	{212.71, 880.00, 0.89},
	{212.71, 932.33, 0.89},
	{212.71, 932.33, 0.89},
	{853.51, 987.77, 0.89},
	{639.91, 493.88, 0.89},
	{212.71, 659.26, 0.89},
	{212.71, 587.33, 0.89},
	{212.71, 554.37, 0.89},
	{212.71, 493.88, 0.89},
	{212.71, 440.00, 0.89},
	{212.71, 880.00, 0.89},
	{212.71, 783.99, 0.89},
	{212.71, 739.99, 0.89},
	{212.71, 659.26, 0.89},
	{212.71, 880.00, 0.89},
	{212.71, 783.99, 0.89},
	{212.71, 739.99, 0.89},
	{212.71, 659.26, 0.89},
	{639.91, 493.88, 0.89},
	{212.71, 659.26, 0.89},
	{212.71, 587.33, 0.89},
	{212.71, 554.37, 0.89},
	{212.71, 493.88, 0.89},
	{212.71, 440.00, 0.89},
	{212.71, 440.00, 0.89},
	{212.71, 493.88, 0.89},
	{212.71, 554.37, 0.89},
	{212.71, 587.33, 0.89},
	{212.71, 440.00, 0.89},
	{212.71, 493.88, 0.89},
	{212.71, 554.37, 0.89},
	{212.71, 587.33, 0.89},
	{426.31, 659.26, 428.09},
	{426.31, 880.00, 428.09},
	{639.91, 587.33, 0.89},
	{212.71, 440.00, 0.89},
	{212.71, 369.99, 0.89},
	{212.71, 293.66, 0.89},
	{212.71, 369.99, 0.89},
	{212.71, 440.00, 0.89},
	{212.71, 587.33, 0.89},
	{212.71, 440.00, 0.89},
	{212.71, 587.33, 0.89},
	{212.71, 739.99, 0.89},
	{426.31, 880.00, 0.89},
	{426.31, 554.37, 0.89},
	{639.91, 587.33, 0.89},
	{212.71, 440.00, 0.89},
	{212.71, 369.99, 0.89},
	{212.71, 293.66, 0.89},
	{212.71, 369.99, 0.89},
	{212.71, 440.00, 0.89},
	{212.71, 587.33, 0.89},
	{212.71, 440.00, 0.89},
	{212.71, 587.33, 0.89},
	{212.71, 739.99, 0.89},
	{426.31, 880.00, 0.89},
	{426.31, 554.37, 0.89},
	{426.31, 587.33, 214.49},
	{212.71, 440.00, 0.89},
	{426.31, 587.33, 214.49},
	{212.71, 440.00, 0.89},
	{426.31, 587.33, 0.89},
	{319.51, 293.66, 0.89},
	{105.91, 293.66, 0.89},
	{853.51, 293.66, 0},
	{0, 0, 0}};	

/* sound for 3 short and one long */

struct play short_3_long_1[] = {
	{300, 400, 10},
	{300, 400, 10},
	{300, 400, 10},
	{1100, 400, 970},
	{300, 400, 10},
	{300, 400, 10},
	{300, 400, 10},
	{1100, 400, 2970},
	{0, 0, 0}};

struct play long1[] = {
	{1100, 400, 2900},
	{1100, 400, 2900},
	{0, 0, 0}};

static void begin_tone(int fd, double freq1)
{
	uintptr_t argp = 0;
	int64_t freq = freq1 * 1000;


	if (freq != 0) {
		argp = ((BELL_CLOCK * 1000)/freq) & 0xffff;
	}

	if (fd >= 0)
		ioctl(fd, KIOCSOUND, argp);
}


static void end_tone(int fd)
{
	if (fd >= 0)
		ioctl(fd, KIOCSOUND, 0);
}

/*
 * Play sound according to the error code submitted
 */

void beep(int error)
{
	int fd = -1;
	struct play *p, *choosen;

	switch (error) {
		case -EKEYREJECTED:
			choosen = short_3_long_1;
			break;
		case -ENOENT:
			choosen = long1;
			break;
		default:
			return;
	}

	if ((fd = open("/dev/tty", O_WRONLY)) < 0) {
                if ((fd = open("/dev/tty0", O_WRONLY)) < 0) {
                        if ((fd = open("/dev/console", O_WRONLY)) < 0) {
                                return;
                        }
                }
        }

	for (int i = 0; i < 8; i++) {
		p = choosen;
		while (p->length > 0.0 || p->freq > 0.0 || p->delay > 0.0)
		{
			begin_tone(fd, p->freq);
			usleep(p->length * 1000);
			if (p->delay > 0) {
				end_tone(fd);
				usleep(p->delay * 1000);
			}
			p++;
		}
	}
	end_tone(fd);
	close(fd);
}
